### <a name="_b7urdng99y53"></a>**Название задачи:**

### <a name="_hjk0fkfyohdk"></a>**Автор:**

### <a name="_uanumrh8zrui"></a>**Дата:**

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:


| **№** | **Действующие лица или системы**                                                                                                        | **Use Case**                                                       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|   1   | Клиент, сотрудник бек-офиса                                                                                                               | Открыть депозит через интернет-банк | Предусловие: клиент авторизовался в интернет-банке.<br /> 1. Клиент видит спиок депозитов. <br />2. Клиент выбирает сче и оставляет заявку на открытие депозита.<br /> 2. Интернет-банк отправляет клиенту СМС-код для подтверждения создания заявки.<br />4. Клиент вводить СМС-код и подтверждает создание заявки. 5. Интернет-банк создается в АСБ заявку на открытие депозита.<br />6. Сотрудник бек-офиса депозитов видит заявку и подтверждает ее в АБС.<br />7. АБС отправляет клиенту СМС об открытии депозита.<br />8. Клиент видит депозит в интернет-банке.<br />**Альтернативы** <br />Сотрудник бек-офиса отклоняет заявку с указанием причины. <br /> Клиент в интернет-банке видит, что заявка отклонена, и причины ее отклонения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|   2   | Новый клиент, сотрудник кол-центра, сотрудрик фронт офиса, сотрудни бек-офиса депозитов | Открыть депозит через сайт (и офис)    | 1. Новый клиент видит спиок депозитов на сайте с актуальными ставками.<br /><br />2. Клиент оставляет заявку на обратный звонок.<br />3. Сотрудник кол-центра перезванивает новому клиенту и возможно предлагает особые условия. <br />4. Клиент по телефону подтверждает намерние открыть депозит. <br />5. Сотрудник кол-центра создает заявку на депозит в системе кол-центра.<br />6. Система кол-центра создает заявку в АБС.<br />7. Сотрудник бек-офиса депозитов видит заявку и подтверждает ее в АБС.<br />8. АБС отправляет клиенту СМС о подтверждении заявки.<br />9. Новый клиент приходит в офис для потверждения личности.<br />10. Сотрудник фронт офиса создаёт запись о клиенте и депозит в АБС. Выдаёт клиенту необходимые документы. Когда документы подписаны, сотрудник загружает их в АБС.<br />11. Клиент получается доступ в интернет-банк и видит в нем депозит. <br />**Альтернативы** <br />Сотрудник бек-офиса отклоняет заявку с указанием причины. <br /> Новые клиент получает СМС с информацией, что заявка отклонена, и причины ее отклонения. Сотрудник кол-центра в смистеме кол-центра видит, что заявка отклонена, и причины ее отклонения |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

Опишите здесь нефункциональные требования и архитектурно-значимые требования.


| **№** | **Требование**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| :------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|   1   | Сайт должен работать только по шифрованному протоколу                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   2   | Интернет-банк должен работать только по шифрованному протоколу                                                                                                                                                                                                                                                                                                                                                                                                   |
|   3   | Все сервисы должны работать 24/7                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   4   | Все сервисы должны быть доступны в 99,9% случаев, в том числе при сбоях в ЦОД.                                                                                                                                                                                                                                                                                                                                                                                 |
|   5   | У банка есть резервный ЦОД, в случае сбоя можно переключиться на него.                                                                                                                                                                                                                                                                                                                                                                                         |
|   6   | Отклик сайта должен быть менее 100 мс.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|   7   | Отклик интернет банка должен быть менее 100 мс.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   8   | Отклик АБС для обработки он-лайн заявок должен быть менее 100 мс.                                                                                                                                                                                                                                                                                                                                                                                                     |
|   9   | Отклик системы кол-центра для обработки он-лайн заявок должен быть менее 100 мс.                                                                                                                                                                                                                                                                                                                                                                         |
|   10   | Нужно предусмотреть равномерное горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД                                                                                                                                                                                                                                                                               |
|   11   | АБС может масштабироваться только вертикально из-за своей базы данных.                                                                                                                                                                                                                                                                                                                                                                                      |
|   12   | Если нужны очереди сообщений, то лучше использовать Kafka на перспективу.<br />Текущая версия платформы интернет-банка несовместима с Кафкой. <br />Возможно, стоит подумать о переводе интернет-банка на микросервисную архитектуру, но пока только в рамках задачи открытия депозитов. |
|   13   | Нужно избежать доработок в ядре системы интернет-банка                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   14   | При доработках во всех системах нужно как можно больше использовать технологии, которые уже есть в банке. Например, базы данных MS SQL и Oracle.<br />Можно развернуть новые технологии, но необходимо, чтобы они были совместимы с существующими платформами разработки.                                 |
|   15   | Желательно, чтобы внутри банка уже была экспертиза — сотрудники понимали новые технологии хотя бы на уровне языков программирования.                                                                                                                                                                                                                                                                   |
|   16   | Нужно избежать прямой работы интернет-банка с API АБС в новом процессе                                                                                                                                                                                                                                                                                                                                                                                          |

<br />
Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения.


| Код требования | Решение для выполнения требования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| R1, R2, P5, +R6             | Для равномерного распределения запросов между бекендами сайта и интернет банка, серверами и ЦОД принято решение использовать API Gateway Nginx. Шлюзов должно быть минимум 2 для их горячего резервирования. Доступность 99,9% иначе не достигнуть.Распределение запросов между самими шлюзами в случае поломки одного из них выполняется средствами DNS.<br /><br />Резервирование ЦОД можно оставить холодным.                                                                                                                                                                                                                                                       |
| P1, P2, P3, P4, S2, +R5     | Для обеспечения быстрого отлика принято решение все взаимодействия между системами построить через очередь сообщений Kafka. В том числе взаимодействие с API АБС<br /><br />Пользовательские интерфейс внутренних и внешних систем быстро получает ответ об отправке запроса, но сам запрос идет до исполнителя через очередь. Поэтому, например, для того, чтобы увидеть открытые депозит в интернет банке пользователю необходимо перегрузить страницу.                                                                                                                                                            |
| +R1, +R8                    | Сервис управления депозитами в интернет банке принято решение выделить в отдельный микросервис со своей БД.<br />Взаимодействия с монолитом выполняется через реплику БД, чтобы избежать синхронного обращения за данными, и сервис управления депозитами не перегружал основное приложение.<br />Пока для простоты этот же микросервис является бекендом для части управления депозитами в веб интерфейсе Интернет банка. Далее по мере разделения Интернет банка на микросервисы возможно потребуется отдельный слой для бека фронта. |
| +R2, +R3, +R4               | Для микросервиса управления депозитами выбраны технологии, по которым есть экспертиза в компании: Springboot, PostgreSQL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Можно не выделять отдельный независимый сервис управления депозитами в интернет банке. Но тогда возрастает риск отказа в обсуживании всего монолита из-за возросшей нагрузки в сценарии открытия депозитов.

Возможно в АБС функциональность управления заявками на депозит стоит выделить в отдельный сервис, чтобы общие проблемы с доступностью АБС не влияли на скорость прохождения заявок в будущем.

**Недостатки, ограничения, риски**

Для монолитной части интернет банка пока нет возможности полностью выполнить требование о равномерном распределении запросов между экземплярами приложения, серверами и ЦОД, так как фронт и бек приложения жестко связаны между собой.

Для минимизации влияния сервиса управления депозитами на весь интернет банк необходима репликация всей БД.

Если заявок станет много, то АБC может не потянуть нагрузку из-за невозможности шардировать БД. Вертикального масштабирования может не хватить.

Для того, чтобы увидеть открытые депозиты в Интернет банке пользователю необходимо перегрузить страницу.

В ADR не рассмотрена проблема того, что при проведении платежей некоторые справочные данные загружаются больше секунды. Причины: 1) проблема не входит в поставленные цели по цифровизации открытия депозитов, 2) не понятно вообще, о какой системе речь. Создается ощущение, что здесь нужна отдельная бизнес цель с ее полной проработкой.
